<html>
<head>
    <title>Tornado Chat Demo</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            connect();
        });

        function connect() {
            var ws = new WebSocket("ws://{{ host }}/socket");
            ws.onmessage = function (event) {
                var data = eval('(' + event.data + ')');

                console.log(data);

                var action = data.action;

                if (action == "add") {
                    html = $('<div id="' + data.line + '"><b>' + data.user + ':</b> ' + data.val + '</div>');
                    $("div#chat").append(html);
                }

                if (action == "remove") {
                    $("div#" + data.val).remove();
                }


            }

            ws.onclose = function () {
                $("div#chat").append($('<b>Connection Terminated</b><br/><br/>'));
                $("input#connect_btn").show();
            }

            $("div#chat").append($('<b>Connection Stabilished</b><br/><br/>'));
            $("input#connect_btn").hide();
        }

        function postMessage() {
            var msg = $("#message").val();

            $.ajax({
                url: 'http://{{ host }}/push',
                method: 'POST',
                data: {
                    action: 'add',
                    csrf_token: '{{ csrf_token }}',
                    val: msg
                },
                success: function (re) {
                    console.log("Data pushed");
                    $("#message").val('')
                }
            });
        }

    </script>

</head>
<body>
<h1>Chat Area</h1>

<div id="chat">

</div>

<br/><br/>
<strong>Message:</strong>
<input type="text" id="message"/>
<input type="button" onclick="postMessage()" value="SEND"/>
<input type="button" id="connect_btn" onclick="connect()" value="CONNECT"/>


</body>
</html>